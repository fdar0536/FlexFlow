syntax = "proto3";

option go_package = "FF/protos";

package ff;

import "types.proto";
import "google/api/annotations.proto";

service Queue {
  rpc ListPending(QueueReq) returns (stream ListTaskRes) {
    option (google.api.http) = {
      get: "/queue/listpending"
    };
  }

  rpc ListFinished(QueueReq) returns (stream ListTaskRes) {
    option (google.api.http) = {
      get: "/queue/listfinished"
    };
  }

  rpc PendingDetails(TaskDetailsReq) returns (TaskDetailsRes) {
    option (google.api.http) = {
      get: "/queue/pendingdetails"
    };
  }

  rpc FinishedDetails(TaskDetailsReq) returns (TaskDetailsRes) {
    option (google.api.http) = {
      get: "/queue/finisheddetails"
    };
  }

  rpc ClearPending(QueueReq) returns (Empty) {
    option (google.api.http) = {
      get: "/queue/clearpending"
    };
  }

  rpc ClearFinished(QueueReq) returns (Empty) {
    option (google.api.http) = {
      get: "/queue/clearfinished"
    };
  }

  rpc CurrentTask(QueueReq) returns (TaskDetailsRes) {
    option (google.api.http) = {
      get: "/queue/currenttask"
    };
  }
  
  rpc AddTask(AddTaskReq) returns (ListTaskRes) {
    option (google.api.http) = {
      post: "/queue/addtask"
      body: "*"
    };
  }
  
  rpc RemoveTask(TaskDetailsReq) returns (Empty) {
    option (google.api.http) = {
      post: "/queue/removetask"
      body: "*"
    };
  }
  
  rpc IsRunning(QueueReq) returns (IsRunningRes) {
    option (google.api.http) = {
      get: "/queue/isrunning"
    };
  }
  
  rpc ReadCurrentOutput(QueueReq) returns (stream Msg) {
    option (google.api.http) = {
      get: "/queue/readcurrentoutput"
    };
  }
  
  rpc Start(QueueReq) returns (Empty) {
    option (google.api.http) = {
      post: "/queue/start"
      body: "*"
    };
  }
  
  rpc Stop(QueueReq) returns (Empty) {
    option (google.api.http) = {
      post: "/queue/stop"
      body: "*"
    };
  }
}

message AddTaskReq {
  string name = 1;
  string workDir = 2;
  string execName = 3;
  repeated string args = 4;
}

message IsRunningRes {
  bool isRunning = 1;
}

message Msg {
  string msg = 1;
}
